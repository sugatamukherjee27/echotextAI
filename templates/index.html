<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>EchoText AI | Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">

    <script>
    // Force a page reload if the user arrives here via the back button
    window.addEventListener('pageshow', function(event) {
        if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
            window.location.reload();
        }
    });
    </script>
</head>
<body>

<header class="navbar">
    <div class="logo">
    <a href="/" style="text-decoration: none; display: flex; align-items: center;">
        <svg class="logo-img" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 5 L15 20 V45 C15 65 35 88 50 95 C65 88 85 65 85 45 V 20 L50 5Z" fill="#1a365d"/>
            
            <rect x="28" y="24" width="24" height="24" rx="4" stroke="white" stroke-width="2.5" fill="none"/>
            <rect x="37" y="29" width="6" height="9" rx="3" fill="white"/>
            <path d="M35 36 C35 39 37 41 40 41 C43 41 45 39 45 36" stroke="white" stroke-width="1.5" fill="none"/>
            <path d="M40 41 V44" stroke="white" stroke-width="1.5"/>

            <rect x="48" y="52" width="24" height="24" rx="4" stroke="white" stroke-width="2.5" fill="none"/>
            <path d="M54 59 H66 M60 59 V68" stroke="white" stroke-width="2" stroke-linecap="round"/>
            <path d="M64 63 H68 M66 63 V68" stroke="white" stroke-width="1.5" stroke-linecap="round"/>

            <path d="M58 36 Q68 36 68 46" stroke="white" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M42 66 Q32 66 32 56" stroke="white" stroke-width="2" fill="none"/>
            
            <path d="M65 43 L68 46 L71 43" stroke="white" stroke-width="2" fill="none"/>
            <path d="M29 59 L32 56 L35 59" stroke="white" stroke-width="2" fill="none"/>
        </svg>
        <span class="logo-text">EchoText AI</span>
    </a>
    </div>

    <nav class="nav-links">
        <a href="{{url_for('history')}}">History</a>
        <a href="{{ url_for('profile') }}">Account</a>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </nav>
</header>

<main class="dashboard-container">
    <div class="input-card">
        <h2>Create New Content</h2>
        
        <form method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
            <div class="form-group">
                <label>I want to generate:</label>
                <select name="output_type" required>
                    <option value="notes">Study Notes</option>
                    <option value="summary">Summary</option>
                    <option value="quiz">Quiz</option>
                    <option value="flashcards">Flashcards</option>
                </select>
            </div>

            <p class="section-divider">Choose your input method:</p>

            <div class="form-group">
                <label class="label-caps">PASTE TEXT</label>
                <textarea name="user_prompt" placeholder="Paste transcript or notes here..."></textarea>
            </div>

            <div class="or-separator"><span>OR</span></div>

            <div class="form-group">
                <label class="label-caps">UPLOAD AUDIO/VIDEO</label>
                <div class="file-input-wrapper">
                    <input type="file" name="audio_file" id="audio_file" accept="audio/*,video/*" hidden onchange="document.getElementById('file-name').textContent = this.files[0].name">
                    <button type="button" class="btn-secondary" onclick="document.getElementById('audio_file').click()">Choose file</button>
                    <span id="file-name" class="file-name-text">No file chosen</span>
                </div>
                    <p class="file-limit-info">Maximum file size allowed: <strong>500MB</strong></p>
            </div>

            <button type="submit" class="btn-generate">Generate Output</button>
        </form>
    </div>

    <div class="output-card {% if not result %}empty-state{% endif %}">
        {% if result %}
            <div class="output-content">
                <h3>Generated Output</h3>
                <div class="result-box">
                    <pre>{{ result }}</pre>
                </div>
                <div class="output-footer" style="margin-top: 20px;">
                    <button class="btn-secondary" onclick="window.location.href='/dashboard'">+ New Prompt</button>
                </div>
            </div>
        {% else %}
            <div class="placeholder-text">
                No output generated yet. Upload a file or paste text to start.
            </div>
        {% endif %}
    </div>
</main>

</body>
</html>
