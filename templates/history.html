<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your History</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>

<div class="container">
    <div class="top-nav">
        <a href="{{ url_for('dashboard') }}" class="back-link">
            <i class='bx bx-left-arrow-alt'></i>Dashboard
        </a>
        <h1 class="page-title">Your History</h1>
    </div>

    <div class="controls-row">
        <form method="get" class="search-form">
            <input 
                type="text" 
                name="q" 
                placeholder="Search in inputs or outputs..." 
                value="{{ query or '' }}"
            >
            <button type="submit" class="search-btn">Search</button>
        </form>
        
        <form method="post" action="{{ url_for('delete_all_history') }}" onsubmit="return confirm('Clear everything?');">
            <button class="clear-all-btn">Clear All History</button>
        </form>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>DATE</th>
                    <th>TYPE</th>
                    <th>PREVIEW</th>
                    <th>EXPORT</th>
                    <th>ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% if records %}
                    {% for item in records %}
                    <tr>
                        <td class="col-date">
                            {% if item.created_at %}
                                {{ item.created_at.strftime('%Y-%m-%d') }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td class="col-type"><span class="badge {{ item.output_type }}">{{ item.output_type }}</span></td>
                        <td class="col-preview">
                            <div class="preview-text">
                                {{ item.output_text[:100] }}...
                            </div>
                        </td>
                        <td class="col-export">
                            <div class="export-links">
                                <a href="{{ url_for('download_history_pdf', history_id=item.id) }}"><i class='bx bxs-file-pdf'></i> PDF</a>
                                <a href="{{ url_for('download_history_docx', history_id=item.id) }}"><i class='bx bxs-file-doc'></i> DOCX</a>
                                <a href="{{ url_for('download_history_txt', history_id=item.id) }}"><i class='bx bxs-file-txt'></i> TXT</a>
                            </div>
                        </td>
                        <td class="col-action">
                            <form method="post" action="{{ url_for('delete_history_item', history_id=item.id) }}">
                                <button class="delete-icon-btn"><i class='bx bx-trash'></i></button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="empty">No history found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

</body>
</html>
